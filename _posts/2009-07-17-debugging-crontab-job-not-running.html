---
layout: post
title: "실행 안되는 crontab 작업 디버깅하기"
date: 2009-07-17 11:14:18.000000000 +09:00
categories:
- "카스탈리엔"
tags:
- Agile
- Linux
- Shell
status: publish
type: post
published: true
meta:
  _publicize_pending: '1'
  lightboxoff: 'false'
  _edit_last: '3788329'
  original_post_id: '770'
  _wp_old_slug: '770'
author:
  login: fan4326
  email: fan4326@gmail.com
  display_name: fan4326
  first_name: ''
  last_name: ''
---
<p>리눅스를 비롯한 유닉스 방식 운영체제에서 주기적인 작업을 수행하기 위해 cron 데몬을 많이 사용합니다. 루트 권한으로 시스템 관리에 필요한 작업을 예약할 수도 있지만, 일반 사용자 계정도 '<code>crontab -e</code>' 명령으로 작업 예약이 가능합니다. 현재 활발하게 개발 중인 프로젝트의 일일 빌드(daily build)를 위해 crontab 작업을 다음과 같이 예약했는데, 문제는 동일한 설정이 한 장비에서만 동작을 안한다는 점입니다. (dooly 계정으로 작업한다고 가정합니다)</p>
<pre># m h  dom mon dow   command
0 23 * * * /home/dooly/build-cms.sh</pre>
<p>빌드 스크립트(<code>/home/dooly/build-cms.sh</code>) 내용은 다음과 같습니다.</p>
<pre>#!/bin/sh
cd /home/dooly/svn/dooly
svn update &amp;&amp; 
sudo make install-depends &amp;&amp; 
make clean &amp;&amp; 
make &amp;&amp; 
make packages &amp;&amp; 
make upload</pre>
<p>인터넷을 찾아보니 다음과 같이 수정하여 로그 파일을 분석하라고 해서 따라해 보았습니다.</p>
<pre># m h  dom mon dow   command
* * * * * /home/dooly/build-cms.sh &gt;&gt; /home/dooly/cron.log 2&gt;&amp;1
* * * * * env &gt; /home/dooly/env.log 2&gt;&amp;1</pre>
<p>로그 파일을 분석하니, 환경 변수 LANG이 ko_KR.UTF-8 로 설정되지 않아서 서브버전 갱신(update) 도중 에러가 발생하고 있었습니다. 그래서 스크립트를 다음과 같이 수정해서 일단 문제는 해결했습니다.</p>
<pre>#!/bin/sh
export LANG=ko_KR.UTF-8
cd /home/dooly/svn/dooly
svn update &amp;&amp; 
sudo make install-depends &amp;&amp; 
make clean &amp;&amp; 
make &amp;&amp; 
make packages &amp;&amp; 
make upload</pre>
<p>하지만 향후 문제 발생시 디버깅을 위해 다음과 같이 crontab 항목도 아예 변경해 두었습니다.</p>
<pre># m h  dom mon dow   command
0 23 * * * /home/dooly/build-cms.sh &gt; /home/dooly/cron.log 2&gt;&amp;1
#* * * * * env &gt; /home/dooly/env.log 2&gt;&amp;1</pre>
<p>물론, 자동으로 메일을 전송하도록 하거나 하는 다른 추가 기능도 가능하겠지만, 일단 이 정도 수준에서 만족하고 현재는 잘 동작하고 있습니다.</p>
